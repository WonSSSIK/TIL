

# 3. 애그리거트 
## 3.1 애그리거트 
테이블이 백 개 이상일 때 개별 테이블 간의 관계를 파악하느라 큰 틀에서 데이터 구조를 이해하는 데 어려움이 생긴다. 
상위 수준에서 모델이 어떻게 엮여 있는지 알아야 전체 모델을 망가뜨리지 않으면서 ㅜ가 요구사항을 모델에 반영할 수 있다. 
복잡한 도메인을 이해하고 고나리하기 쉬운 단위로 만들려면 상위 수준에서 모델을 조망할 수 있는 방법이 필요한데 그 것이 애그리거트 이다. 
애그리거트는 일관성을 관리하는 기준도 되고, 복잡한 도메인을 단순한 구조로 만들어 준다. 
애그리거트는 경계를 갖는다. 한 애그리거트에 속한 구성요소는 대부분이 함께 생성하고, 함께 저거한다. 
도메인 규칙에 따라 함께 생성되는 구성요소는 한 애그리거트에 속할 가능성이 높다. 
실제 도메인 모델을 구성하다보면, 다수의 애그리거트가 한개의 엔티티 객체만 갖는 경우가 많았으며 두 개 이상의 엔티티로 구성되는 애그리거트는 드물다. 

## 3.2 애그리거트 루트 
애그리거트는 여러 객체로 구성되며, 애그리거트에 속한 모든 객체가 정상 상태를 가져야 한다. 
애그리거트 루트엔티티는 애그리거트에 속한 모든 객체가 일관된 상태를 유지하도록 관리한다. 
애그리거트 루트 엔티티는 애그리거트의 대표엔티티 이고, 애그리거트에 속한 객체는 애그리거트 루트 엔티티에 직접 또는 간접적으로 속하게 된다. 


### 도메인 규칙과 일관성 
애그리거트 루트의 핵심 역할은 애그리거트의 일관성을 깨지지 않도록 하는 것이다. 
이를 위해 애그리거트가 제공해야할 도메인 기능을 구현한다. 
애그리거트 루트가 제공하는 메서드는 도메인 규칙에 따라 애그리거트에 속한 객체의 일관성이 깨지지 않도록 구현해야한다. 
애그리거트 외부에서 애그리거트에 속한 객체를 직접 변경하면 안된다. 
 #### 도메인로직 구현 
 - 단순히 필드를 변경하느 set 메서드를 공개(public) 범위로 만들지 않는다. 
 - 밸류 타입은 불변으로 구현한다.

### 애그리거트 루트의 기능 구현
- 애그리거트 루트는 애그리거트 내부의 다른 객체를 조합해서 기능을 완성한다. 
- 애그리거트 루트는 구성요소의 상태 뿐만아니라 기능 실행을 위임하기도 한다. 
- 팀 표준이나 구현 기술의 제약으로 구성요소를 불변으로 구현할 수 없다면, 외부에서 실행할 수 없도록 package 나 protected 범위를 사용해 범위를 제한한다. 

### 트랜잭션 범위 
트랜잭션의 범위는 작을수록 좋다. 
한 트랜잭션에서는 한개의 애그리거트만 수정해야 한다. 
 애그리거트에서 다른 애그리거트를 변경하지 않는다. 
애그리거트는 최대한 서로 독립적이어야 한다. 
한 애그리거트가 다른 애그리거트의 기능에 의존하기 시작하면 애그리거트 간 결합도가 높아진다. 

## 3.3 리포지터리와 애그리거트 



## 3.4 ID를 이용한 애그리거트 참조 
### ID를 이용한 참조와 조회 성능 


## 3.5 애그리거트 간 집합 연산 

## 3.6 애그리거트를 팩토리로 사용하기 

